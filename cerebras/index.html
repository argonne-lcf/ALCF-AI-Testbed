
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://argonne-lcf.github.io/Argonne-AI-Testbed-System/cerebras/">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.5">
    
    
      
        <title>Cerebras (CS-1) - Argonne AI Testbed System</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.21aed14c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Proxima+Nova:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Proxima Nova",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cs-1-quickstart-guide-for-anl" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Mitigate bug: https://github.com/mkdocs/mkdocs/issues/2191 -->



<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://argonne-lcf.github.io/Argonne-AI-Testbed-System/"
      title="Argonne AI Testbed System"
    >
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Logo -->


    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            <a href="https://argonne-lcf.github.io/AITS-Site/" title="Argonne AI Testbed System" >
              Argonne AI Testbed System
            </a>
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Cerebras (CS-1)
            
          </span>
        </div>
      
    </div>

    <!--Adding in Tabs-->
    <!-- Determine class according to level -->



<!-- Tabs with outline -->
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#about" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  <li class="md-tabs__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#services" class="md-tabs__link">
      Testbed Applications
    </a>
  </li>

      
        
  <li class="md-tabs__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#portfolio" class="md-tabs__link">
      Systems
    </a>
  </li>

      
        
      
        
      
        
  <li class="md-tabs__item">
    <a href="https://docs.graphcore.ai/en/latest/" class="md-tabs__link">
      Graphcore
    </a>
  </li>

      
        
  <li class="md-tabs__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#contact" class="md-tabs__link">
      Contact
    </a>
  </li>

      
        
  <li class="md-tabs__item">
    
    
      
    
    <a href=".." class="md-tabs__link md-tabs__link--active">
      Documentation
    </a>
  </li>

      
    </ul>
  </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://argonne-lcf.github.io/Argonne-AI-Testbed-System/" title="Argonne AI Testbed System" class="md-nav__button md-logo" aria-label="Argonne AI Testbed System">
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Logo -->


    </a>
    Argonne AI Testbed System
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#about" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#services" class="md-nav__link">
      Testbed Applications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#portfolio" class="md-nav__link">
      Systems
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Cerebras (CS-1)
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Cerebras (CS-1)
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-log-in-to-the-cs-1-medulla-cluster-at-anl" class="md-nav__link">
    1. Log in to the CS-1 medulla cluster at ANL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-clone-model-zoo-repository-to-home-directory" class="md-nav__link">
    2. Clone model zoo repository to home directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-running-a-model-with-slurm-on-cs-1" class="md-nav__link">
    3. Running a model with Slurm on CS-1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-and-evaluating-on-cpu" class="md-nav__link">
    Training and Evaluating on CPU
  </a>
  
    <nav class="md-nav" aria-label="Training and Evaluating on CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-navigate-to-model-directory" class="md-nav__link">
    1. Navigate to model directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-salloc_node-which-will-both-start-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cs-1-slurm-cluster" class="md-nav__link">
    2. Run salloc_node, which will both start the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the CS-1 Slurm cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-train-and-evaluate-the-model-on-cpu" class="md-nav__link">
    3. Train and evaluate the model on CPU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fast-iteration-and-precompilation-on-cpu" class="md-nav__link">
    Fast iteration and precompilation on CPU
  </a>
  
    <nav class="md-nav" aria-label="Fast iteration and precompilation on CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-navigate-to-model-directory_1" class="md-nav__link">
    1. Navigate to model directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cerebras-cluster" class="md-nav__link">
    2. Run the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the Cerebras cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-run-the-compilation-process-in-validate_only-mode" class="md-nav__link">
    3. Run the compilation process in validate_only mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-run-the-full-compilation-process-in-compile_only-mode" class="md-nav__link">
    4. Run the full compilation process in compile_only mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../sambanova/" class="md-nav__link">
      SambaNova
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://docs.graphcore.ai/en/latest/" class="md-nav__link">
      Graphcore
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://argonne-lcf.github.io/AITS-Site/#contact" class="md-nav__link">
      Contact
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-log-in-to-the-cs-1-medulla-cluster-at-anl" class="md-nav__link">
    1. Log in to the CS-1 medulla cluster at ANL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-clone-model-zoo-repository-to-home-directory" class="md-nav__link">
    2. Clone model zoo repository to home directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-running-a-model-with-slurm-on-cs-1" class="md-nav__link">
    3. Running a model with Slurm on CS-1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-and-evaluating-on-cpu" class="md-nav__link">
    Training and Evaluating on CPU
  </a>
  
    <nav class="md-nav" aria-label="Training and Evaluating on CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-navigate-to-model-directory" class="md-nav__link">
    1. Navigate to model directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-salloc_node-which-will-both-start-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cs-1-slurm-cluster" class="md-nav__link">
    2. Run salloc_node, which will both start the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the CS-1 Slurm cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-train-and-evaluate-the-model-on-cpu" class="md-nav__link">
    3. Train and evaluate the model on CPU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fast-iteration-and-precompilation-on-cpu" class="md-nav__link">
    Fast iteration and precompilation on CPU
  </a>
  
    <nav class="md-nav" aria-label="Fast iteration and precompilation on CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-navigate-to-model-directory_1" class="md-nav__link">
    1. Navigate to model directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cerebras-cluster" class="md-nav__link">
    2. Run the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the Cerebras cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-run-the-compilation-process-in-validate_only-mode" class="md-nav__link">
    3. Run the compilation process in validate_only mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-run-the-full-compilation-process-in-compile_only-mode" class="md-nav__link">
    4. Run the full compilation process in compile_only mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="cs-1-quickstart-guide-for-anl">CS-1 Quickstart Guide for ANL</h1>
<p><em>November 2020</em></p>
<p><strong>Note: For support or questions, please contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;</a>.</strong></p>
<p>This guide provides a quickstart guide to running a training job on the ANL CS-1 cluster with SLURM, using a simple FC model as a demo model.</p>
<p>For more details on how to prepare a model for CS-1 and on the execution model, please see the full CS-1 ML User Guide.</p>
<h4 id="1-log-in-to-the-cs-1-medulla-cluster-at-anl">1. Log in to the CS-1 <code>medulla</code> cluster at ANL</h4>
<p>In order to login, you need a CELS ldap account. Go to <a href="https://accounts.cels.anl.gov/" target="_blank">https://accounts.cels.anl.gov/</a> and create an account. After that, request to join a project named "Cerebras".  </p>
<p>The CS-1 support cluster accepts connections from CELS homes nodes (homes.cels.anl.gov). You can connect to CELS homes nodes first and ssh to cs1. See <a href="https://virtualhelpdesk.cels.anl.gov/docs/linux/login-compute-and-home-nodes/" target="_blank">https://virtualhelpdesk.cels.anl.gov/docs/linux/login-compute-and-home-nodes/</a> for connecting homes nodes.</p>
<p>For your convenience, you can set an ssh proxy as below,</p>
<pre><code># ssh proxy setting ~/.ssh/config
ControlPath ~/.ssh/.control_channels/%h:%p:%r
Host login-gce
User [username]
Hostname logins.cels.anl.gov
ControlMaster auto
ControlPersist yes
LogLevel FATAL

Host homes-gce
User [username]
Hostname homes.cels.anl.gov
ProxyCommand ssh login-gce -q -W %h:%p
ForwardX11 yes

Host cs1-gce
HostName cs1.cels.anl.gov
ProxyCommand ssh login-gce -q -W %h:%p
</code></pre>

<p>and</p>
<pre><code>ssh cs1-gce
</code></pre>

<h4 id="2-clone-model-zoo-repository-to-home-directory">2. Clone model zoo repository to home directory</h4>
<p>Currently, the Cerebras <strong><a href="https://github.com/Cerebras/modelzoo" target="_blank">ModelZoo</a></strong> repo is private. Please contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;</a>, cc: <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#106;&#101;&#115;&#115;&#105;&#99;&#97;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;">&#106;&#101;&#115;&#115;&#105;&#99;&#97;&#64;&#99;&#101;&#114;&#101;&#98;&#114;&#97;&#115;&#46;&#110;&#101;&#116;</a> with your Github username and "UChicago ModelZoo Access" in the subject line.</p>
<pre><code>git clone git@github.com:Cerebras/modelzoo.git
</code></pre>

<p>In the modelzoo directory, you should see several examples. To name a few:</p>
<ol>
<li>
<p><code>fc_mnist</code>, A simple multi-layer perceptron model composed of fully-connected layers for performing handwriting recognition on the MNIST dataset. Check README.md for more detail.</p>
</li>
<li>
<p><code>bert</code>, BERT model implementation. Check README.md for more detail.</p>
</li>
<li>
<p><code>rnn_sentiment</code>, LSTM-based sentiment analysis model that predicts sentiment type on a passage</p>
</li>
</ol>
<p><strong><a href="https://bluejeans.com/playback/s/mZJ5DqnjvP2nsLPCwegfMqjRkz6gzaaqG80NmjmpU4bpx6teHotpximQ3PsMos4f" target="_blank">Model zoo walkthrough video is available here.</a></strong></p>
<p>For the purposes of this quickstart, we will use the <code>fc_mnist</code> model.</p>
<pre><code>cd modelzoo/fc_mnist/tf/
</code></pre>

<h4 id="3-running-a-model-with-slurm-on-cs-1">3. Running a model with Slurm on CS-1</h4>
<p>For more details on Slurm options please see the full <strong><a href="https://docs.google.com/document/d/12u7eooakOlv16nF4-4Cw7njArE_Vk5LMxKwo-PKcozI/edit#heading=h.xg9jdr68szft" target="_blank">CS-1 User Guide</a></strong> section <em>Executing a training job on CS-1 with Slurm</em>.</p>
<p>The common below trains the simple FC model for 100,000 steps, takes a checkpoint every 10,000 steps, and tells Slurm to launch 1 input worker node to feed the training job. The <code>num_steps</code> and <code>save_checkpoints_steps</code> parameters can also be set in the <code>params.yml</code> file.</p>
<pre><code>NUM_WORKER_NODES=1 srun_train python run.py --mode train --cs_ip 10.80.0.100 --max_steps 100000
</code></pre>

<p>After running this command, you should see similar output to the below: </p>
<pre><code>srun: job 5834 queued and waiting for resources
srun: job 5834 has been allocated resources
...
INFO:tensorflow:Graph was finalized.
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
INFO:tensorflow:Saving checkpoints for 0 into model_dir/model.ckpt.
INFO:tensorflow:Programming CS-1 fabric. This may take a couple of minutes - please do not interrupt.
INFO:tensorflow:Fabric programmed
INFO:tensorflow:Coordinator fully up. Waiting for Streaming (using 0.97% out of 301600 cores on the fabric)
INFO:tensorflow:Graph was finalized.
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
...
INFO:tensorflow:Training finished with 25600000 samples in 187.465 seconds, 136558.69 samples / second
INFO:tensorflow:Saving checkpoints for 100000 into model_dir/model.ckpt.
INFO:tensorflow:global step 100000: loss = 1.901388168334961e-05 (532.0 steps/sec)
INFO:tensorflow:global step 100000: loss = 1.901388168334961e-05 (532.0 steps/sec)
INFO:tensorflow:Loss for final step: 1.9e-05.
</code></pre>

<h3 id="training-and-evaluating-on-cpu">Training and Evaluating on CPU</h3>
<p>To train and eval on CPU, run the Cerebras Singularity container in interactive mode, then run the <code>run.py</code> script, specifying ‘train’ or ‘eval’ for the ‘--mode’ script argument. In these scripts, if the <code>cs_ip</code> address is not specified, it will automatically run on CPU. </p>
<h4 id="1-navigate-to-model-directory">1. Navigate to model directory</h4>
<pre><code>cd modelzoo/fc_mnist/tf/
</code></pre>

<h4 id="2-run-salloc_node-which-will-both-start-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cs-1-slurm-cluster">2. Run salloc_node, which will both start the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the CS-1 Slurm cluster</h4>
<pre><code>salloc_node
</code></pre>

<h4 id="3-train-and-evaluate-the-model-on-cpu">3. Train and evaluate the model on CPU</h4>
<pre><code># train the simple model on CPU
Singularity&gt; python run.py --mode train

# run eval on the simple model on CPU
Singularity&gt; python run.py --mode eval
</code></pre>

<h3 id="fast-iteration-and-precompilation-on-cpu">Fast iteration and precompilation on CPU</h3>
<p>CerebrasEstimator provides a lightweight model "verification" mode through the compile() function. In this mode, compile() will only run through the first few stages of the Cerebras Graph Compiler (CGC), up until kernel library matching. This step is very fast and allows you to quickly iterate on your model code and determine if you are using any TensorFlow layers or functionality that is unsupported by either XLA or CGC.</p>
<h4 id="1-navigate-to-model-directory_1">1. Navigate to model directory</h4>
<pre><code>cd modelzoo/fc_mnist/tf/
</code></pre>

<h4 id="2-run-the-cerebras-singularity-container-in-interactive-shell-mode-and-reserve-a-worker-cpu-node-in-the-cerebras-cluster">2. Run the Cerebras Singularity container in interactive shell mode and reserve a worker CPU node in the Cerebras cluster</h4>
<pre><code># do not use salloc_node
singularity shell -B /data /data/shared/software/singularity/cbcore_latest.sif
</code></pre>

<h4 id="3-run-the-compilation-process-in-validate_only-mode">3. Run the compilation process in <code>validate_only</code> mode</h4>
<pre><code>Singularity&gt; python run.py --mode validate_only 
...
XLA Extraction Complete
=============== Starting Cerebras Compilation ===============
Cerebras compilation completed: 100%|██████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:02s,  1.23s/stages]
=============== Cerebras Compilation Completed ===============
</code></pre>

<p><code>validate_only</code> mode checks kernel compatibility of your model.
Once your model passes, run the full compilation to generate the CS-1 executable.</p>
<h4 id="4-run-the-full-compilation-process-in-compile_only-mode">4. Run the full compilation process in <code>compile_only</code> mode</h4>
<p>This runs the full compilation through all stages of the Cerebras software stack to generate a CS-1 executable. </p>
<pre><code>Singularity&gt; python run.py --mode compile_only 
...
XLA Extraction Complete
=============== Starting Cerebras Compilation ===============
Cerebras compilation completed: |                    | 17/? [00:18s,  1.09s/stages]
=============== Cerebras Compilation Completed ===============
</code></pre>

<p>If this is successful, your model is guaranteed to run on CS-1. You can also use this mode to run pre-compilations of many different model configurations offline, so you can more fully utilize allotted CS-1 cluster time. CGC will detect if a binary already exists for a particular model config and will skip compiling on-the-fly during training if it detects one.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="../sambanova/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SambaNova
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['header.autohide'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>